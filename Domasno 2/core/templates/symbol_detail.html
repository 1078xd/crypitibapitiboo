{% extends "base.html" %}

{% block title %}{{ symbol }} | Crypitibapitiboo{% endblock %}
{% block body_class %}analyze-bg{% endblock %}

{% block content %}
<section class="market-section">
  <div class="market-card">

    <h1>{{ symbol }}</h1>

    <p>
      Overall signal:
      <strong class="signal {{ overall_signal|lower }}">{{ overall_signal }}</strong>
    </p>

    <p>
      Timeframe:
      <a href="?tf=daily">Daily</a> |
      <a href="?tf=weekly">Weekly</a> |
      <a href="?tf=monthly">Monthly</a>
    </p>

    {% if has_enough_data %}

      <p style="opacity:0.7;">
        Using {{ actual_candles }} candles (min required: {{ min_required }})
      </p>

      <hr style="opacity:0.2; margin:16px 0;">

      <h3>Latest candle</h3>
      <div style="display:grid; grid-template-columns:repeat(2, 1fr); gap:10px; opacity:0.95;">
        <div>Date: <strong>{{ latest.date }}</strong></div>
        <div>Close: <strong>{{ latest.close }}</strong></div>
        <div>Open: <strong>{{ latest.open }}</strong></div>
        <div>High: <strong>{{ latest.high }}</strong></div>
        <div>Low: <strong>{{ latest.low }}</strong></div>
        <div>Volume: <strong>{{ latest.volume }}</strong></div>
      </div>

      <hr style="opacity:0.2; margin:16px 0;">

      <h3>Technical Indicators</h3>

      <div class="market-header" style="grid-template-columns: 1.9fr 1.2fr 0.9fr;">
        <div>Indicator</div>
        <div>Value</div>
        <div>Signal</div>
      </div>

      {% for name, sig in signals.items %}
        <div class="market-row" style="grid-template-columns: 1.9fr 1.2fr 0.9fr; align-items:center;">
          <div style="font-weight:600;">{{ name }}</div>

          <div style="opacity:0.9;">
            {% if name == "RSI (14)" %}
              {{ values.rsi|floatformat:2 }}
            {% elif name == "MACD" %}
              {{ values.macd|floatformat:6 }}
              <span style="opacity:0.75;">(sig {{ values.macd_signal|floatformat:6 }})</span>
            {% elif name == "Stochastic Oscillator" %}
              K={{ values.stoch_k|floatformat:2 }},
              D={{ values.stoch_d|floatformat:2 }}
            {% elif name == "ADX (14)" %}
              {{ values.adx|floatformat:2 }}
            {% elif name == "CCI (20)" %}
              {{ values.cci|floatformat:2 }}
            {% elif name == "SMA (20)" %}
              {{ values.sma_20|floatformat:6 }}
            {% elif name == "EMA (20)" %}
              {{ values.ema_20|floatformat:6 }}
            {% elif name == "WMA (20)" %}
              {{ values.wma_20|floatformat:6 }}
            {% elif name == "Bollinger Bands" %}
              L={{ values.bb_lower|floatformat:6 }},
              U={{ values.bb_upper|floatformat:6 }}
            {% elif name == "Volume SMA (20)" %}
              {{ values.vol_sma_20|floatformat:2 }}
            {% else %}
              -
            {% endif %}
          </div>

          <div class="signal {{ sig|lower }}">
            {{ sig }}
          </div>
        </div>
      {% endfor %}

      <p style="margin-top:12px; opacity:0.7;">
        ADX signal uses trend strength (ADX â‰¥ 20) + direction (Close vs SMA20).
      </p>

    {% else %}
      <p>Not enough data to display {{ timeframe }} indicators.</p>
      <p style="opacity:0.7;">
        Need at least {{ min_required }} candles, you have {{ actual_candles }}.
      </p>
    {% endif %}

  </div>
</section>
{% endblock %}
